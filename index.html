<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>餐廳點餐系統</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #e74c3c;
            --secondary-color: #34495e;
            --background-color: #f8f9fa;
            --card-background: #ffffff;
            --text-color: #2c3e50;
            --border-color: #dee2e6;
            --success-color: #27ae60;
            --warning-color: #f39c12;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), #c0392b);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .table-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .language-selector {
            select {
                padding: 0.5rem;
                border: none;
                border-radius: 5px;
                background: white;
                color: var(--text-color);
                cursor: pointer;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .category-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .category-tab {
            padding: 0.75rem 1.5rem;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .category-tab.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .menu-item {
            background: var(--card-background);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .menu-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .menu-item-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #999;
        }

        .menu-item-content {
            padding: 1.5rem;
        }

        .menu-item-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        .menu-item-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .menu-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-item-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .add-to-cart-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .add-to-cart-btn:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        .cart-button {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--success-color);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            z-index: 50;
        }

        .cart-button:hover {
            transform: scale(1.1);
        }

        .cart-count {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--warning-color);
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .option-group {
            margin-bottom: 1.5rem;
        }

        .option-label {
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: block;
        }

        .option-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .option-item {
            padding: 0.5rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .option-item.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .quantity-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .quantity-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-display {
            font-size: 1.5rem;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }

        .textarea-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .confirm-btn {
            width: 100%;
            background: var(--success-color);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 1rem;
        }

        /* Cart Modal */
        .cart-items {
            max-height: 400px;
            overflow-y: auto;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .cart-item-options {
            font-size: 0.8rem;
            color: #666;
        }

        .cart-item-price {
            font-weight: bold;
            color: var(--primary-color);
            margin-left: 1rem;
        }

        .cart-total {
            padding: 1.5rem;
            border-top: 2px solid var(--border-color);
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
            background: #f8f9fa;
        }

        .checkout-btn {
            width: 100%;
            background: var(--success-color);
            color: white;
            border: none;
            padding: 1rem;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 1rem;
            border-radius: 10px;
        }

        .settings-panel {
            position: fixed;
            top: 80px;
            right: -300px;
            width: 300px;
            height: calc(100vh - 80px);
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 90;
            overflow-y: auto;
            padding: 1rem;
        }

        .settings-panel.show {
            right: 0;
        }

        .settings-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .color-input {
            width: 100%;
            height: 40px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
        }

        .setting-group {
            margin-bottom: 1.5rem;
        }

        .setting-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .menu-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 1rem;
            }

            .table-info {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo" id="restaurantName">美食餐廳</div>
            <div class="table-info">
                <div id="tableNumber">桌號: 1</div>
                <div class="language-selector">
                    <select id="languageSelect">
                        <option value="zh">中文</option>
                        <option value="en">English</option>
                        <option value="ja">日本語</option>
                        <option value="ko">한국어</option>
                    </select>
                </div>
                <button class="settings-btn" onclick="toggleSettings()">⚙️</button>
            </div>
        </div>
    </header>

    <div class="settings-panel" id="settingsPanel">
        <h3>設定</h3>
        <div class="setting-group">
            <label class="setting-label">桌號</label>
            <input type="number" id="tableInput" value="1" min="1" onchange="updateTableNumber()">
        </div>
        <div class="setting-group">
            <label class="setting-label">背景顏色</label>
            <input type="color" class="color-input" id="bgColorInput" value="#f8f9fa" onchange="updateBgColor()">
        </div>
        <div class="setting-group">
            <label class="setting-label">卡片背景顏色</label>
            <input type="color" class="color-input" id="cardColorInput" value="#ffffff" onchange="updateCardColor()">
        </div>
        <div class="setting-group">
            <label class="setting-label">主題色</label>
            <input type="color" class="color-input" id="primaryColorInput" value="#e74c3c" onchange="updatePrimaryColor()">
        </div>
        <div class="setting-group">
            <label class="setting-label">資料儲存選項</label>
            <div>
                <label><input type="checkbox" id="saveToSheet" checked> Google Sheets</label><br>
                <label><input type="checkbox" id="saveToDb" checked> 資料庫</label>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="category-tabs" id="categoryTabs">
            <div class="category-tab active" onclick="filterCategory('all')" data-key="all">全部</div>
            <div class="category-tab" onclick="filterCategory('appetizer')" data-key="appetizer">開胃菜</div>
            <div class="category-tab" onclick="filterCategory('main')" data-key="main">主餐</div>
            <div class="category-tab" onclick="filterCategory('drink')" data-key="drink">飲品</div>
            <div class="category-tab" onclick="filterCategory('dessert')" data-key="dessert">甜點</div>
        </div>

        <div class="menu-grid" id="menuGrid">
            <!-- Menu items will be populated by JavaScript -->
        </div>
    </div>
    
    <button class="cart-button" id="cartButton" disabled onclick="openCart()">
        🛒
        <span class="cart-count" id="cartCount">0</span>
    </button>

    <!-- Item Detail Modal -->
    <div class="modal" id="itemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">商品詳情</h3>
                <button class="close-btn" onclick="closeModal('itemModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="option-group">
                    <label class="option-label" data-key="rice_type">米飯種類</label>
                    <div class="option-items" id="riceOptions">
                        <div class="option-item" onclick="selectOption('rice', 'white')" data-key="white_rice">白飯</div>
                        <div class="option-item" onclick="selectOption('rice', 'brown')" data-key="brown_rice">糙米飯</div>
                        <div class="option-item" onclick="selectOption('rice', 'mixed')" data-key="mixed_rice">五穀飯</div>
                    </div>
                </div>

                <div class="option-group">
                    <label class="option-label" data-key="spice_level">辣度</label>
                    <div class="option-items" id="spiceOptions">
                        <div class="option-item" onclick="selectOption('spice', 'none')" data-key="no_spice">不辣</div>
                        <div class="option-item" onclick="selectOption('spice', 'mild')" data-key="mild_spice">微辣</div>
                        <div class="option-item" onclick="selectOption('spice', 'medium')" data-key="medium_spice">中辣</div>
                        <div class="option-item" onclick="selectOption('spice', 'hot')" data-key="hot_spice">大辣</div>
                    </div>
                </div>

                <div class="option-group">
                    <label class="option-label" data-key="size">大小</label>
                    <div class="option-items" id="sizeOptions">
                        <div class="option-item" onclick="selectOption('size', 'small')" data-key="small">小份</div>
                        <div class="option-item" onclick="selectOption('size', 'medium')" data-key="medium">中份</div>
                        <div class="option-item" onclick="selectOption('size', 'large')" data-key="large">大份</div>
                    </div>
                </div>

                <div class="option-group">
                    <label class="option-label" data-key="set_meal">套餐選擇</label>
                    <div class="option-items" id="setOptions">
                        <div class="option-item" onclick="selectOption('set', 'none')" data-key="no_set">單點</div>
                        <div class="option-item" onclick="selectOption('set', 'drink')" data-key="drink_set">+飲料套餐</div>
                        <div class="option-item" onclick="selectOption('set', 'soup')" data-key="soup_set">+湯品套餐</div>
                        <div class="option-item" onclick="selectOption('set', 'full')" data-key="full_set">完整套餐</div>
                    </div>
                </div>

                <div class="option-group">
                    <label class="option-label" data-key="notes">備註</label>
                    <textarea class="textarea-input" id="notesInput" placeholder="請輸入特殊需求..."></textarea>
                </div>

                <div class="quantity-control">
                    <button class="quantity-btn" onclick="changeQuantity(-1)">-</button>
                    <span class="quantity-display" id="quantityDisplay">1</span>
                    <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
                </div>

                <button class="confirm-btn" onclick="addToCart()" data-key="add_to_cart">加入購物車</button>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" data-key="shopping_cart">購物車</h3>
                <button class="close-btn" onclick="closeModal('cartModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="cart-items" id="cartItems">
                    <!-- Cart items will be populated by JavaScript -->
                </div>
                <div class="cart-total">
                    <div data-key="total">總計: $<span id="cartTotal">0</span></div>
                </div>
                <button class="checkout-btn" onclick="checkout()" data-key="place_order">送出訂單</button>
            </div>
        </div>
    </div>

    <script>
        // 語言翻譯對照表
        const translations = {
            zh: {
                all: '全部', appetizer: '開胃菜', main: '主餐', drink: '飲品', dessert: '甜點',
                rice_type: '米飯種類', white_rice: '白飯', brown_rice: '糙米飯', mixed_rice: '五穀飯',
                spice_level: '辣度', no_spice: '不辣', mild_spice: '微辣', medium_spice: '中辣', hot_spice: '大辣',
                size: '大小', small: '小份', medium: '中份', large: '大份',
                set_meal: '套餐選擇', no_set: '單點', drink_set: '+飲料套餐', soup_set: '+湯品套餐', full_set: '完整套餐',
                notes: '備註', add_to_cart: '加入購物車', shopping_cart: '購物車', total: '總計',
                place_order: '送出訂單', table_number: '桌號'
            },
            en: {
                all: 'All', appetizer: 'Appetizers', main: 'Main Dishes', drink: 'Drinks', dessert: 'Desserts',
                rice_type: 'Rice Type', white_rice: 'White Rice', brown_rice: 'Brown Rice', mixed_rice: 'Mixed Grain Rice',
                spice_level: 'Spice Level', no_spice: 'No Spice', mild_spice: 'Mild', medium_spice: 'Medium', hot_spice: 'Hot',
                size: 'Size', small: 'Small', medium: 'Medium', large: 'Large',
                set_meal: 'Set Meal', no_set: 'Single Item', drink_set: '+Drink Set', soup_set: '+Soup Set', full_set: 'Full Set',
                notes: 'Notes', add_to_cart: 'Add to Cart', shopping_cart: 'Shopping Cart', total: 'Total',
                place_order: 'Place Order', table_number: 'Table'
            },
            ja: {
                all: '全て', appetizer: '前菜', main: 'メイン', drink: 'ドリンク', dessert: 'デザート',
                rice_type: 'ご飯の種類', white_rice: '白ご飯', brown_rice: '玄米', mixed_rice: '雑穀米',
                spice_level: '辛さ', no_spice: '辛くない', mild_spice: '少し辛い', medium_spice: '中辛', hot_spice: '大辛',
                size: 'サイズ', small: 'Sサイズ', medium: 'Mサイズ', large: 'Lサイズ',
                set_meal: 'セット', no_set: '単品', drink_set: '+ドリンクセット', soup_set: '+スープセット', full_set: 'フルセット',
                notes: '備考', add_to_cart: 'カートに追加', shopping_cart: 'ショッピングカート', total: '合計',
                place_order: '注文する', table_number: 'テーブル'
            },
            ko: {
                all: '전체', appetizer: '애피타이저', main: '메인', drink: '음료', dessert: '디저트',
                rice_type: '밥 종류', white_rice: '흰밥', brown_rice: '현미밥', mixed_rice: '잡곡밥',
                spice_level: '매운 정도', no_spice: '안 매움', mild_spice: '약간 매움', medium_spice: '보통 매움', hot_spice: '매움',
                size: '크기', small: '소', medium: '중', large: '대',
                set_meal: '세트 메뉴', no_set: '단품', drink_set: '+음료 세트', soup_set: '+스프 세트', full_set: '풀 세트',
                notes: '비고', add_to_cart: '장바구니 담기', shopping_cart: '장바구니', total: '총계',
                place_order: '주문하기', table_number: '테이블'
            }
        };

        // 示例菜單數據
        const menuData = [
            {
                id: 1,
                name: {zh: '宮保雞丁', en: 'Kung Pao Chicken', ja: '宮保鶏丁', ko: '궁보계정'},
                description: {zh: '經典川菜，香辣可口', en: 'Classic Sichuan dish, spicy and delicious', ja: '伝統的な四川料理、辛くて美味しい', ko: '전통 사천 요리, 맵고 맛있음'},
                price: 280,
                category: 'main',
                image: '🍗'
            },
            {
                id: 2,
                name: {zh: '麻婆豆腐', en: 'Mapo Tofu', ja: '麻婆豆腐', ko: '마파두부'},
                description: {zh: '嫩滑豆腐配香辣醬汁', en: 'Silky tofu with spicy sauce', ja: 'なめらかな豆腐に辛いソース', ko: '부드러운 두부와 매운 소스'},
                price: 220,
                category: 'main',
                image: '🥘'
            },
            {
                id: 3,
                name: {zh: '糖醋排骨', en: 'Sweet and Sour Ribs', ja: '酢豚', ko: '탕수갈비'},
                description: {zh: '酸甜開胃，老少皆宜', en: 'Sweet and sour, perfect for all ages', ja: '甘酸っぱくて食欲をそそる', ko: '달콤하고 새콤한 맛'},
                price: 320,
                category: 'main',
                image: '🍖'
            },
            {
                id: 4,
                name: {zh: '涼拌黃瓜', en: 'Cucumber Salad', ja: 'きゅうりの和え物', ko: '오이무침'},
                description: {zh: '清爽開胃小菜', en: 'Refreshing appetizer', ja: 'さっぱりとした前菜', ko: '상큼한 전채요리'},
                price: 80,
                category: 'appetizer',
                image: '🥒'
            },
            {
                id: 5,
                name: {zh: '可樂', en: 'Coca Cola', ja: 'コーラ', ko: '콜라'},
                description: {zh: '經典碳酸飲料', en: 'Classic carbonated drink', ja: 'クラシックな炭酸飲料', ko: '클래식 탄산음료'},
                price: 30,
                category: 'drink',
                image: '🥤'
            },
            {
                id: 6,
                name: {zh: '紅豆湯', en: 'Red Bean Soup', ja: 'ぜんざい', ko: '팥죽'},
                description: {zh: '溫熱甜品', en: 'Warm sweet dessert', ja: '温かい甘いデザート', ko: '따뜻한 달콤한 디저트'},
                price: 60,
                category: 'dessert',
                image: '🍲'
            }
        ];

        // 全局變量
        let cart = [];
        let currentLanguage = 'zh';
        let currentItem = null;
        let currentQuantity = 1;
        let selectedOptions = {};

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            renderMenu();
            updateLanguage();
            updateTableNumber();
        
            // 語言切換事件
            document.getElementById('languageSelect').addEventListener('change', function () {
                currentLanguage = this.value;
                updateLanguage();
                renderMenu();
            });
        
            // ✅ 在這裡啟用購物車按鈕
            document.getElementById('cartButton').disabled = false;
        }

        function renderMenu(category = 'all') {
            const menuGrid = document.getElementById('menuGrid');
            const filteredMenu = category === 'all' ? menuData : menuData.filter(item => item.category === category);
            
            menuGrid.innerHTML = filteredMenu.map(item => `
                <div class="menu-item" onclick="openItemModal(${item.id})">
                    <div class="menu-item-image">${item.image}</div>
                    <div class="menu-item-content">
                        <div class="menu-item-title">${item.name[currentLanguage]}</div>
                        <div class="menu-item-description">${item.description[currentLanguage]}</div>
                        <div class="menu-item-footer">
                            <div class="menu-item-price">${item.price}</div>
                            <button class="add-to-cart-btn" onclick="event.stopPropagation(); quickAddToCart(${item.id})">${translations[currentLanguage].add_to_cart}</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterCategory(category) {
            // 更新分類標籤樣式
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('onclick').includes(`'${category}'`)) {
                    tab.classList.add('active');
                }
            });
            renderMenu(category);
        }

        function updateLanguage() {
            // 更新所有有 data-key 屬性的元素
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.getAttribute('data-key');
                if (translations[currentLanguage][key]) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = translations[currentLanguage][key];
                    } else {
                        element.textContent = translations[currentLanguage][key];
                    }
                }
            });
        }

        function openItemModal(itemId) {
            currentItem = menuData.find(item => item.id === itemId);
            if (!currentItem) return;

            document.getElementById('modalTitle').textContent = currentItem.name[currentLanguage];
            document.getElementById('quantityDisplay').textContent = '1';
            document.getElementById('notesInput').value = '';
            
            // 重置選項
            selectedOptions = {
                rice: 'white',
                spice: 'none',
                size: 'medium',
                set: 'none'
            };
            currentQuantity = 1;

            // 重置選項按鈕樣式
            document.querySelectorAll('.option-item').forEach(item => {
                item.classList.remove('selected');
            });

            // 設定默認選項
            document.querySelector('[onclick="selectOption(\'rice\', \'white\')"]').classList.add('selected');
            document.querySelector('[onclick="selectOption(\'spice\', \'none\')"]').classList.add('selected');
            document.querySelector('[onclick="selectOption(\'size\', \'medium\')"]').classList.add('selected');
            document.querySelector('[onclick="selectOption(\'set\', \'none\')"]').classList.add('selected');

            document.getElementById('itemModal').classList.add('show');
        }

        function selectOption(type, value) {
            selectedOptions[type] = value;
            
            // 更新選項按鈕樣式
            document.querySelectorAll(`[onclick*="selectOption('${type}',"]`).forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`[onclick="selectOption('${type}', '${value}')"]`).classList.add('selected');
        }

        function changeQuantity(delta) {
            currentQuantity = Math.max(1, currentQuantity + delta);
            document.getElementById('quantityDisplay').textContent = currentQuantity;
        }

        function addToCart() {
            if (!currentItem) return;

            const cartItem = {
                id: currentItem.id,
                name: currentItem.name[currentLanguage],
                price: currentItem.price,
                quantity: currentQuantity,
                options: {...selectedOptions},
                notes: document.getElementById('notesInput').value,
                timestamp: new Date().toISOString()
            };

            cart.push(cartItem);
            updateCartDisplay();
            closeModal('itemModal');
            
            // 顯示添加成功的提示
            showNotification('已加入購物車！');
        }

        function quickAddToCart(itemId) {
            const item = menuData.find(i => i.id === itemId);
            if (!item) return;

            const cartItem = {
                id: item.id,
                name: item.name[currentLanguage],
                price: item.price,
                quantity: 1,
                options: {
                    rice: 'white',
                    spice: 'none',
                    size: 'medium',
                    set: 'none'
                },
                notes: '',
                timestamp: new Date().toISOString()
            };

            cart.push(cartItem);
            updateCartDisplay();
            showNotification('已加入購物車！');
        }

        function updateCartDisplay() {
            const cartCount = document.getElementById('cartCount');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            cartCount.style.display = totalItems > 0 ? 'flex' : 'none';
        }

        function openCart() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
        
            // 防呆檢查
            if (!cartItems || !cartTotal) {
                console.error("找不到 cartItems 或 cartTotal，請確認 HTML 是否載入完成");
                return;
            }
        
            if (cart.length === 0) {
                cartItems.innerHTML = '<div style="text-align: center; padding: 2rem; color: #666;">購物車是空的</div>';
                cartTotal.textContent = '0';
            } else {
                cartItems.innerHTML = cart.map((item, index) => `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name} x${item.quantity}</div>
                            <div class="cart-item-options">
                                ${Object.entries(item.options).map(([key, value]) =>
                                    `${translations[currentLanguage][key] || key}: ${translations[currentLanguage][value] || value}`
                                ).join(', ')}
                                ${item.notes ? `<br>備註: ${item.notes}` : ''}
                            </div>
                        </div>
                        <div class="cart-item-price">${item.price * item.quantity}</div>
                        <button onclick="removeFromCart(${index})" style="background: #e74c3c; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 3px; margin-left: 0.5rem; cursor: pointer;">×</button>
                    </div>
                `).join('');
        
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                cartTotal.textContent = total;
            }
        
            document.getElementById('cartModal').classList.add('show');
        }


        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartDisplay();
            openCart(); // 重新渲染購物車
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: #27ae60;
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 5px;
                z-index: 1001;
                animation: slideInRight 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }

        async function checkout() {
            if (cart.length === 0) {
                alert('購物車是空的！');
                return;
            }

            const orderData = {
                tableNumber: document.getElementById('tableInput').value,
                items: cart,
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                timestamp: new Date().toISOString(),
                language: currentLanguage
            };

            try {
                // 模擬發送訂單到服務器
                await sendOrderToServer(orderData);
                
                // 清空購物車
                cart = [];
                updateCartDisplay();
                closeModal('cartModal');
                
                showNotification('訂單已送出！');
                
            } catch (error) {
                console.error('訂單發送失敗:', error);
                alert('訂單發送失敗，請重試！');
            }
        }

        async function sendOrderToServer(orderData) {
            // 這裡需要根據您的後端實現進行調整
            console.log('發送訂單數據:', orderData);
            
            const saveToSheet = document.getElementById('saveToSheet').checked;
            const saveToDb = document.getElementById('saveToDb').checked;
            
            const promises = [];
            
            if (saveToSheet) {
                promises.push(saveToGoogleSheets(orderData));
            }
            
            if (saveToDb) {
                promises.push(saveToDatabase(orderData));
            }
            
            await Promise.all(promises);
        }

        async function saveToGoogleSheets(orderData) {
            // Google Sheets API 集成
            // 您需要設置 Google Apps Script 來接收數據
            const scriptUrl = 'https://script.google.com/macros/s/AKfycbxnDlXeKp4Mb6YHLWe8z2B8iuu5nESM0RRI7qGxFQlKyplU1nydG3f3h7B4Ugxbz99D/exec'; // 替換為您的 Google Apps Script URL
            
            try {
                const response = await fetch(scriptUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                
                if (!response.ok) {
                    throw new Error('Google Sheets 保存失敗');
                }
                
                console.log('已保存到 Google Sheets');
            } catch (error) {
                console.error('Google Sheets 保存錯誤:', error);
                // 不拋出錯誤，允許其他保存方式繼續
            }
        }

        async function saveToDatabase(orderData) {
            // 資料庫 API 集成
            const apiUrl = 'YOUR_DATABASE_API_URL'; // 替換為您的資料庫 API URL
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                
                if (!response.ok) {
                    throw new Error('資料庫保存失敗');
                }
                
                console.log('已保存到資料庫');
            } catch (error) {
                console.error('資料庫保存錯誤:', error);
                // 不拋出錯誤，允許其他保存方式繼續
            }
        }

        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('show');
        }

        function updateTableNumber() {
            const tableNumber = document.getElementById('tableInput').value;
            document.getElementById('tableNumber').textContent = `${translations[currentLanguage].table_number || '桌號'}: ${tableNumber}`;
        }

        function updateBgColor() {
            const color = document.getElementById('bgColorInput').value;
            document.documentElement.style.setProperty('--background-color', color);
        }

        function updateCardColor() {
            const color = document.getElementById('cardColorInput').value;
            document.documentElement.style.setProperty('--card-background', color);
        }

        function updatePrimaryColor() {
            const color = document.getElementById('primaryColorInput').value;
            document.documentElement.style.setProperty('--primary-color', color);
        }

        // 點擊模態框外部關閉
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                closeModal(e.target.id);
            }
        });

        // 添加動畫樣式
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); }
                to { transform: translateX(0); }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); }
                to { transform: translateX(100%); }
            }
        `;
        document.head.appendChild(style);

        // PWA 支持（可選）
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        // 自動識別桌號
        function getTableNumberFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const tableParam = urlParams.get('table');
            if (tableParam) {
                document.getElementById('tableInput').value = tableParam;
                updateTableNumber();
            }
        }
        
        // 在頁面載入時執行
        document.addEventListener('DOMContentLoaded', function() {
            getTableNumberFromURL();
            initializeApp();
        });
    </script>
</body>
</html>
