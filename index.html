<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¤å»³é»é¤ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #e74c3c;
            --secondary-color: #34495e;
            --background-color: #f8f9fa;
            --card-background: #ffffff;
            --text-color: #2c3e50;
            --border-color: #dee2e6;
            --success-color: #27ae60;
            --warning-color: #f39c12;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), #c0392b);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .table-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .language-selector {
            select {
                padding: 0.5rem;
                border: none;
                border-radius: 5px;
                background: white;
                color: var(--text-color);
                cursor: pointer;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .category-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .category-tab {
            padding: 0.75rem 1.5rem;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .category-tab.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .menu-item {
            background: var(--card-background);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .menu-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .menu-item-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #999;
        }

        .menu-item-content {
            padding: 1.5rem;
        }

        .menu-item-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        .menu-item-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .menu-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-item-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .add-to-cart-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .add-to-cart-btn:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        .cart-button {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--success-color);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            z-index: 50;
        }

        .cart-button:hover {
            transform: scale(1.1);
        }

        .cart-count {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--warning-color);
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .option-group {
            margin-bottom: 1.5rem;
        }

        .option-label {
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: block;
        }

        .option-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .option-item {
            padding: 0.5rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .option-item.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .quantity-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .quantity-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-display {
            font-size: 1.5rem;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }

        .textarea-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .confirm-btn {
            width: 100%;
            background: var(--success-color);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 1rem;
        }

        /* Cart Modal */
        .cart-items {
            max-height: 400px;
            overflow-y: auto;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .cart-item-options {
            font-size: 0.8rem;
            color: #666;
        }

        .cart-item-price {
            font-weight: bold;
            color: var(--primary-color);
            margin-left: 1rem;
        }

        .cart-total {
            padding: 1.5rem;
            border-top: 2px solid var(--border-color);
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
            background: #f8f9fa;
        }

        .checkout-btn {
            width: 100%;
            background: var(--success-color);
            color: white;
            border: none;
            padding: 1rem;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 1rem;
            border-radius: 10px;
        }

        .settings-panel {
            position: fixed;
            top: 80px;
            right: -300px;
            width: 300px;
            height: calc(100vh - 80px);
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 90;
            overflow-y: auto;
            padding: 1rem;
        }

        .settings-panel.show {
            right: 0;
        }

        .settings-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .color-input {
            width: 100%;
            height: 40px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
        }

        .setting-group {
            margin-bottom: 1.5rem;
        }

        .setting-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .menu-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 1rem;
            }

            .table-info {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo" id="restaurantName">ç¾é£Ÿé¤å»³</div>
            <div class="table-info">
                <div id="tableNumber">æ¡Œè™Ÿ: 1</div>
                <div class="language-selector">
                    <select id="languageSelect">
                        <option value="zh">ä¸­æ–‡</option>
                        <option value="en">English</option>
                        <option value="ja">æ—¥æœ¬èª</option>
                        <option value="ko">í•œêµ­ì–´</option>
                    </select>
                </div>
                <button class="settings-btn" onclick="toggleSettings()">âš™ï¸</button>
            </div>
        </div>
    </header>

    <div class="settings-panel" id="settingsPanel">
        <h3>è¨­å®š</h3>
        <div class="setting-group">
            <label class="setting-label">æ¡Œè™Ÿ</label>
            <input type="number" id="tableInput" value="1" min="1" onchange="updateTableNumber()">
        </div>
        <div class="setting-group">
            <label class="setting-label">èƒŒæ™¯é¡è‰²</label>
            <input type="color" class="color-input" id="bgColorInput" value="#f8f9fa" onchange="updateBgColor()">
        </div>
        <div class="setting-group">
            <label class="setting-label">å¡ç‰‡èƒŒæ™¯é¡è‰²</label>
            <input type="color" class="color-input" id="cardColorInput" value="#ffffff" onchange="updateCardColor()">
        </div>
        <div class="setting-group">
            <label class="setting-label">ä¸»é¡Œè‰²</label>
            <input type="color" class="color-input" id="primaryColorInput" value="#e74c3c" onchange="updatePrimaryColor()">
        </div>
        <div class="setting-group">
            <label class="setting-label">è³‡æ–™å„²å­˜é¸é …</label>
            <div>
                <label><input type="checkbox" id="saveToSheet" checked> Google Sheets</label><br>
                <label><input type="checkbox" id="saveToDb" checked> è³‡æ–™åº«</label>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="category-tabs" id="categoryTabs">
            <div class="category-tab active" onclick="filterCategory('all')" data-key="all">å…¨éƒ¨</div>
            <div class="category-tab" onclick="filterCategory('appetizer')" data-key="appetizer">é–‹èƒƒèœ</div>
            <div class="category-tab" onclick="filterCategory('main')" data-key="main">ä¸»é¤</div>
            <div class="category-tab" onclick="filterCategory('drink')" data-key="drink">é£²å“</div>
            <div class="category-tab" onclick="filterCategory('dessert')" data-key="dessert">ç”œé»</div>
        </div>

        <div class="menu-grid" id="menuGrid">
            <!-- Menu items will be populated by JavaScript -->
        </div>
    </div>
    
    <button class="cart-button" id="cartButton" disabled onclick="openCart()">
        ğŸ›’
        <span class="cart-count" id="cartCount">0</span>
    </button>

    <!-- Item Detail Modal -->
    <div class="modal" id="itemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">å•†å“è©³æƒ…</h3>
                <button class="close-btn" onclick="closeModal('itemModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="option-group">
                    <label class="option-label" data-key="rice_type">ç±³é£¯ç¨®é¡</label>
                    <div class="option-items" id="riceOptions">
                        <div class="option-item" onclick="selectOption('rice', 'white')" data-key="white_rice">ç™½é£¯</div>
                        <div class="option-item" onclick="selectOption('rice', 'brown')" data-key="brown_rice">ç³™ç±³é£¯</div>
                        <div class="option-item" onclick="selectOption('rice', 'mixed')" data-key="mixed_rice">äº”ç©€é£¯</div>
                    </div>
                </div>

                <div class="option-group">
                    <label class="option-label" data-key="spice_level">è¾£åº¦</label>
                    <div class="option-items" id="spiceOptions">
                        <div class="option-item" onclick="selectOption('spice', 'none')" data-key="no_spice">ä¸è¾£</div>
                        <div class="option-item" onclick="selectOption('spice', 'mild')" data-key="mild_spice">å¾®è¾£</div>
                        <div class="option-item" onclick="selectOption('spice', 'medium')" data-key="medium_spice">ä¸­è¾£</div>
                        <div class="option-item" onclick="selectOption('spice', 'hot')" data-key="hot_spice">å¤§è¾£</div>
                    </div>
                </div>

                <div class="option-group">
                    <label class="option-label" data-key="size">å¤§å°</label>
                    <div class="option-items" id="sizeOptions">
                        <div class="option-item" onclick="selectOption('size', 'small')" data-key="small">å°ä»½</div>
                        <div class="option-item" onclick="selectOption('size', 'medium')" data-key="medium">ä¸­ä»½</div>
                        <div class="option-item" onclick="selectOption('size', 'large')" data-key="large">å¤§ä»½</div>
                    </div>
                </div>

                <div class="option-group">
                    <label class="option-label" data-key="set_meal">å¥—é¤é¸æ“‡</label>
                    <div class="option-items" id="setOptions">
                        <div class="option-item" onclick="selectOption('set', 'none')" data-key="no_set">å–®é»</div>
                        <div class="option-item" onclick="selectOption('set', 'drink')" data-key="drink_set">+é£²æ–™å¥—é¤</div>
                        <div class="option-item" onclick="selectOption('set', 'soup')" data-key="soup_set">+æ¹¯å“å¥—é¤</div>
                        <div class="option-item" onclick="selectOption('set', 'full')" data-key="full_set">å®Œæ•´å¥—é¤</div>
                    </div>
                </div>

                <div class="option-group">
                    <label class="option-label" data-key="notes">å‚™è¨»</label>
                    <textarea class="textarea-input" id="notesInput" placeholder="è«‹è¼¸å…¥ç‰¹æ®Šéœ€æ±‚..."></textarea>
                </div>

                <div class="quantity-control">
                    <button class="quantity-btn" onclick="changeQuantity(-1)">-</button>
                    <span class="quantity-display" id="quantityDisplay">1</span>
                    <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
                </div>

                <button class="confirm-btn" onclick="addToCart()" data-key="add_to_cart">åŠ å…¥è³¼ç‰©è»Š</button>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" data-key="shopping_cart">è³¼ç‰©è»Š</h3>
                <button class="close-btn" onclick="closeModal('cartModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="cart-items" id="cartItems">
                    <!-- Cart items will be populated by JavaScript -->
                </div>
                <div class="cart-total">
                    <div data-key="total">ç¸½è¨ˆ: $<span id="cartTotal">0</span></div>
                </div>
                <button class="checkout-btn" onclick="checkout()" data-key="place_order">é€å‡ºè¨‚å–®</button>
            </div>
        </div>
    </div>

    <script>
        // èªè¨€ç¿»è­¯å°ç…§è¡¨
        const translations = {
            zh: {
                all: 'å…¨éƒ¨', appetizer: 'é–‹èƒƒèœ', main: 'ä¸»é¤', drink: 'é£²å“', dessert: 'ç”œé»',
                rice_type: 'ç±³é£¯ç¨®é¡', white_rice: 'ç™½é£¯', brown_rice: 'ç³™ç±³é£¯', mixed_rice: 'äº”ç©€é£¯',
                spice_level: 'è¾£åº¦', no_spice: 'ä¸è¾£', mild_spice: 'å¾®è¾£', medium_spice: 'ä¸­è¾£', hot_spice: 'å¤§è¾£',
                size: 'å¤§å°', small: 'å°ä»½', medium: 'ä¸­ä»½', large: 'å¤§ä»½',
                set_meal: 'å¥—é¤é¸æ“‡', no_set: 'å–®é»', drink_set: '+é£²æ–™å¥—é¤', soup_set: '+æ¹¯å“å¥—é¤', full_set: 'å®Œæ•´å¥—é¤',
                notes: 'å‚™è¨»', add_to_cart: 'åŠ å…¥è³¼ç‰©è»Š', shopping_cart: 'è³¼ç‰©è»Š', total: 'ç¸½è¨ˆ',
                place_order: 'é€å‡ºè¨‚å–®', table_number: 'æ¡Œè™Ÿ'
            },
            en: {
                all: 'All', appetizer: 'Appetizers', main: 'Main Dishes', drink: 'Drinks', dessert: 'Desserts',
                rice_type: 'Rice Type', white_rice: 'White Rice', brown_rice: 'Brown Rice', mixed_rice: 'Mixed Grain Rice',
                spice_level: 'Spice Level', no_spice: 'No Spice', mild_spice: 'Mild', medium_spice: 'Medium', hot_spice: 'Hot',
                size: 'Size', small: 'Small', medium: 'Medium', large: 'Large',
                set_meal: 'Set Meal', no_set: 'Single Item', drink_set: '+Drink Set', soup_set: '+Soup Set', full_set: 'Full Set',
                notes: 'Notes', add_to_cart: 'Add to Cart', shopping_cart: 'Shopping Cart', total: 'Total',
                place_order: 'Place Order', table_number: 'Table'
            },
            ja: {
                all: 'å…¨ã¦', appetizer: 'å‰èœ', main: 'ãƒ¡ã‚¤ãƒ³', drink: 'ãƒ‰ãƒªãƒ³ã‚¯', dessert: 'ãƒ‡ã‚¶ãƒ¼ãƒˆ',
                rice_type: 'ã”é£¯ã®ç¨®é¡', white_rice: 'ç™½ã”é£¯', brown_rice: 'ç„ç±³', mixed_rice: 'é›‘ç©€ç±³',
                spice_level: 'è¾›ã•', no_spice: 'è¾›ããªã„', mild_spice: 'å°‘ã—è¾›ã„', medium_spice: 'ä¸­è¾›', hot_spice: 'å¤§è¾›',
                size: 'ã‚µã‚¤ã‚º', small: 'Sã‚µã‚¤ã‚º', medium: 'Mã‚µã‚¤ã‚º', large: 'Lã‚µã‚¤ã‚º',
                set_meal: 'ã‚»ãƒƒãƒˆ', no_set: 'å˜å“', drink_set: '+ãƒ‰ãƒªãƒ³ã‚¯ã‚»ãƒƒãƒˆ', soup_set: '+ã‚¹ãƒ¼ãƒ—ã‚»ãƒƒãƒˆ', full_set: 'ãƒ•ãƒ«ã‚»ãƒƒãƒˆ',
                notes: 'å‚™è€ƒ', add_to_cart: 'ã‚«ãƒ¼ãƒˆã«è¿½åŠ ', shopping_cart: 'ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆ', total: 'åˆè¨ˆ',
                place_order: 'æ³¨æ–‡ã™ã‚‹', table_number: 'ãƒ†ãƒ¼ãƒ–ãƒ«'
            },
            ko: {
                all: 'ì „ì²´', appetizer: 'ì• í”¼íƒ€ì´ì €', main: 'ë©”ì¸', drink: 'ìŒë£Œ', dessert: 'ë””ì €íŠ¸',
                rice_type: 'ë°¥ ì¢…ë¥˜', white_rice: 'í°ë°¥', brown_rice: 'í˜„ë¯¸ë°¥', mixed_rice: 'ì¡ê³¡ë°¥',
                spice_level: 'ë§¤ìš´ ì •ë„', no_spice: 'ì•ˆ ë§¤ì›€', mild_spice: 'ì•½ê°„ ë§¤ì›€', medium_spice: 'ë³´í†µ ë§¤ì›€', hot_spice: 'ë§¤ì›€',
                size: 'í¬ê¸°', small: 'ì†Œ', medium: 'ì¤‘', large: 'ëŒ€',
                set_meal: 'ì„¸íŠ¸ ë©”ë‰´', no_set: 'ë‹¨í’ˆ', drink_set: '+ìŒë£Œ ì„¸íŠ¸', soup_set: '+ìŠ¤í”„ ì„¸íŠ¸', full_set: 'í’€ ì„¸íŠ¸',
                notes: 'ë¹„ê³ ', add_to_cart: 'ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°', shopping_cart: 'ì¥ë°”êµ¬ë‹ˆ', total: 'ì´ê³„',
                place_order: 'ì£¼ë¬¸í•˜ê¸°', table_number: 'í…Œì´ë¸”'
            }
        };

        // ç¤ºä¾‹èœå–®æ•¸æ“š
        const menuData = [
            {
                id: 1,
                name: {zh: 'å®®ä¿é›ä¸', en: 'Kung Pao Chicken', ja: 'å®®ä¿é¶ä¸', ko: 'ê¶ë³´ê³„ì •'},
                description: {zh: 'ç¶“å…¸å·èœï¼Œé¦™è¾£å¯å£', en: 'Classic Sichuan dish, spicy and delicious', ja: 'ä¼çµ±çš„ãªå››å·æ–™ç†ã€è¾›ãã¦ç¾å‘³ã—ã„', ko: 'ì „í†µ ì‚¬ì²œ ìš”ë¦¬, ë§µê³  ë§›ìˆìŒ'},
                price: 280,
                category: 'main',
                image: 'ğŸ—'
            },
            {
                id: 2,
                name: {zh: 'éº»å©†è±†è…', en: 'Mapo Tofu', ja: 'éº»å©†è±†è…', ko: 'ë§ˆíŒŒë‘ë¶€'},
                description: {zh: 'å«©æ»‘è±†è…é…é¦™è¾£é†¬æ±', en: 'Silky tofu with spicy sauce', ja: 'ãªã‚ã‚‰ã‹ãªè±†è…ã«è¾›ã„ã‚½ãƒ¼ã‚¹', ko: 'ë¶€ë“œëŸ¬ìš´ ë‘ë¶€ì™€ ë§¤ìš´ ì†ŒìŠ¤'},
                price: 220,
                category: 'main',
                image: 'ğŸ¥˜'
            },
            {
                id: 3,
                name: {zh: 'ç³–é†‹æ’éª¨', en: 'Sweet and Sour Ribs', ja: 'é…¢è±š', ko: 'íƒ•ìˆ˜ê°ˆë¹„'},
                description: {zh: 'é…¸ç”œé–‹èƒƒï¼Œè€å°‘çš†å®œ', en: 'Sweet and sour, perfect for all ages', ja: 'ç”˜é…¸ã£ã±ãã¦é£Ÿæ¬²ã‚’ããã‚‹', ko: 'ë‹¬ì½¤í•˜ê³  ìƒˆì½¤í•œ ë§›'},
                price: 320,
                category: 'main',
                image: 'ğŸ–'
            },
            {
                id: 4,
                name: {zh: 'æ¶¼æ‹Œé»ƒç“œ', en: 'Cucumber Salad', ja: 'ãã‚…ã†ã‚Šã®å’Œãˆç‰©', ko: 'ì˜¤ì´ë¬´ì¹¨'},
                description: {zh: 'æ¸…çˆ½é–‹èƒƒå°èœ', en: 'Refreshing appetizer', ja: 'ã•ã£ã±ã‚Šã¨ã—ãŸå‰èœ', ko: 'ìƒí¼í•œ ì „ì±„ìš”ë¦¬'},
                price: 80,
                category: 'appetizer',
                image: 'ğŸ¥’'
            },
            {
                id: 5,
                name: {zh: 'å¯æ¨‚', en: 'Coca Cola', ja: 'ã‚³ãƒ¼ãƒ©', ko: 'ì½œë¼'},
                description: {zh: 'ç¶“å…¸ç¢³é…¸é£²æ–™', en: 'Classic carbonated drink', ja: 'ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãªç‚­é…¸é£²æ–™', ko: 'í´ë˜ì‹ íƒ„ì‚°ìŒë£Œ'},
                price: 30,
                category: 'drink',
                image: 'ğŸ¥¤'
            },
            {
                id: 6,
                name: {zh: 'ç´…è±†æ¹¯', en: 'Red Bean Soup', ja: 'ãœã‚“ã–ã„', ko: 'íŒ¥ì£½'},
                description: {zh: 'æº«ç†±ç”œå“', en: 'Warm sweet dessert', ja: 'æ¸©ã‹ã„ç”˜ã„ãƒ‡ã‚¶ãƒ¼ãƒˆ', ko: 'ë”°ëœ»í•œ ë‹¬ì½¤í•œ ë””ì €íŠ¸'},
                price: 60,
                category: 'dessert',
                image: 'ğŸ²'
            }
        ];

        // å…¨å±€è®Šé‡
        let cart = [];
        let currentLanguage = 'zh';
        let currentItem = null;
        let currentQuantity = 1;
        let selectedOptions = {};

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            renderMenu();
            updateLanguage();
            updateTableNumber();
        
            // èªè¨€åˆ‡æ›äº‹ä»¶
            document.getElementById('languageSelect').addEventListener('change', function () {
                currentLanguage = this.value;
                updateLanguage();
                renderMenu();
            });
        
            // âœ… åœ¨é€™è£¡å•Ÿç”¨è³¼ç‰©è»ŠæŒ‰éˆ•
            document.getElementById('cartButton').disabled = false;
        }

        function renderMenu(category = 'all') {
            const menuGrid = document.getElementById('menuGrid');
            const filteredMenu = category === 'all' ? menuData : menuData.filter(item => item.category === category);
            
            menuGrid.innerHTML = filteredMenu.map(item => `
                <div class="menu-item" onclick="openItemModal(${item.id})">
                    <div class="menu-item-image">${item.image}</div>
                    <div class="menu-item-content">
                        <div class="menu-item-title">${item.name[currentLanguage]}</div>
                        <div class="menu-item-description">${item.description[currentLanguage]}</div>
                        <div class="menu-item-footer">
                            <div class="menu-item-price">${item.price}</div>
                            <button class="add-to-cart-btn" onclick="event.stopPropagation(); quickAddToCart(${item.id})">${translations[currentLanguage].add_to_cart}</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterCategory(category) {
            // æ›´æ–°åˆ†é¡æ¨™ç±¤æ¨£å¼
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('onclick').includes(`'${category}'`)) {
                    tab.classList.add('active');
                }
            });
            renderMenu(category);
        }

        function updateLanguage() {
            // æ›´æ–°æ‰€æœ‰æœ‰ data-key å±¬æ€§çš„å…ƒç´ 
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.getAttribute('data-key');
                if (translations[currentLanguage][key]) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = translations[currentLanguage][key];
                    } else {
                        element.textContent = translations[currentLanguage][key];
                    }
                }
            });
        }

        function openItemModal(itemId) {
            currentItem = menuData.find(item => item.id === itemId);
            if (!currentItem) return;

            document.getElementById('modalTitle').textContent = currentItem.name[currentLanguage];
            document.getElementById('quantityDisplay').textContent = '1';
            document.getElementById('notesInput').value = '';
            
            // é‡ç½®é¸é …
            selectedOptions = {
                rice: 'white',
                spice: 'none',
                size: 'medium',
                set: 'none'
            };
            currentQuantity = 1;

            // é‡ç½®é¸é …æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.option-item').forEach(item => {
                item.classList.remove('selected');
            });

            // è¨­å®šé»˜èªé¸é …
            document.querySelector('[onclick="selectOption(\'rice\', \'white\')"]').classList.add('selected');
            document.querySelector('[onclick="selectOption(\'spice\', \'none\')"]').classList.add('selected');
            document.querySelector('[onclick="selectOption(\'size\', \'medium\')"]').classList.add('selected');
            document.querySelector('[onclick="selectOption(\'set\', \'none\')"]').classList.add('selected');

            document.getElementById('itemModal').classList.add('show');
        }

        function selectOption(type, value) {
            selectedOptions[type] = value;
            
            // æ›´æ–°é¸é …æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll(`[onclick*="selectOption('${type}',"]`).forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`[onclick="selectOption('${type}', '${value}')"]`).classList.add('selected');
        }

        function changeQuantity(delta) {
            currentQuantity = Math.max(1, currentQuantity + delta);
            document.getElementById('quantityDisplay').textContent = currentQuantity;
        }

        function addToCart() {
            if (!currentItem) return;

            const cartItem = {
                id: currentItem.id,
                name: currentItem.name[currentLanguage],
                price: currentItem.price,
                quantity: currentQuantity,
                options: {...selectedOptions},
                notes: document.getElementById('notesInput').value,
                timestamp: new Date().toISOString()
            };

            cart.push(cartItem);
            updateCartDisplay();
            closeModal('itemModal');
            
            // é¡¯ç¤ºæ·»åŠ æˆåŠŸçš„æç¤º
            showNotification('å·²åŠ å…¥è³¼ç‰©è»Šï¼');
        }

        function quickAddToCart(itemId) {
            const item = menuData.find(i => i.id === itemId);
            if (!item) return;

            const cartItem = {
                id: item.id,
                name: item.name[currentLanguage],
                price: item.price,
                quantity: 1,
                options: {
                    rice: 'white',
                    spice: 'none',
                    size: 'medium',
                    set: 'none'
                },
                notes: '',
                timestamp: new Date().toISOString()
            };

            cart.push(cartItem);
            updateCartDisplay();
            showNotification('å·²åŠ å…¥è³¼ç‰©è»Šï¼');
        }

        function updateCartDisplay() {
            const cartCount = document.getElementById('cartCount');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            cartCount.style.display = totalItems > 0 ? 'flex' : 'none';
        }

        function openCart() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
        
            // é˜²å‘†æª¢æŸ¥
            if (!cartItems || !cartTotal) {
                console.error("æ‰¾ä¸åˆ° cartItems æˆ– cartTotalï¼Œè«‹ç¢ºèª HTML æ˜¯å¦è¼‰å…¥å®Œæˆ");
                return;
            }
        
            if (cart.length === 0) {
                cartItems.innerHTML = '<div style="text-align: center; padding: 2rem; color: #666;">è³¼ç‰©è»Šæ˜¯ç©ºçš„</div>';
                cartTotal.textContent = '0';
            } else {
                cartItems.innerHTML = cart.map((item, index) => `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name} x${item.quantity}</div>
                            <div class="cart-item-options">
                                ${Object.entries(item.options).map(([key, value]) =>
                                    `${translations[currentLanguage][key] || key}: ${translations[currentLanguage][value] || value}`
                                ).join(', ')}
                                ${item.notes ? `<br>å‚™è¨»: ${item.notes}` : ''}
                            </div>
                        </div>
                        <div class="cart-item-price">${item.price * item.quantity}</div>
                        <button onclick="removeFromCart(${index})" style="background: #e74c3c; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 3px; margin-left: 0.5rem; cursor: pointer;">Ã—</button>
                    </div>
                `).join('');
        
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                cartTotal.textContent = total;
            }
        
            document.getElementById('cartModal').classList.add('show');
        }


        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartDisplay();
            openCart(); // é‡æ–°æ¸²æŸ“è³¼ç‰©è»Š
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: #27ae60;
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 5px;
                z-index: 1001;
                animation: slideInRight 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }

        async function checkout() {
            if (cart.length === 0) {
                alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼');
                return;
            }

            const orderData = {
                tableNumber: document.getElementById('tableInput').value,
                items: cart,
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                timestamp: new Date().toISOString(),
                language: currentLanguage
            };

            try {
                // æ¨¡æ“¬ç™¼é€è¨‚å–®åˆ°æœå‹™å™¨
                await sendOrderToServer(orderData);
                
                // æ¸…ç©ºè³¼ç‰©è»Š
                cart = [];
                updateCartDisplay();
                closeModal('cartModal');
                
                showNotification('è¨‚å–®å·²é€å‡ºï¼');
                
            } catch (error) {
                console.error('è¨‚å–®ç™¼é€å¤±æ•—:', error);
                alert('è¨‚å–®ç™¼é€å¤±æ•—ï¼Œè«‹é‡è©¦ï¼');
            }
        }

        async function sendOrderToServer(orderData) {
            // é€™è£¡éœ€è¦æ ¹æ“šæ‚¨çš„å¾Œç«¯å¯¦ç¾é€²è¡Œèª¿æ•´
            console.log('ç™¼é€è¨‚å–®æ•¸æ“š:', orderData);
            
            const saveToSheet = document.getElementById('saveToSheet').checked;
            const saveToDb = document.getElementById('saveToDb').checked;
            
            const promises = [];
            
            if (saveToSheet) {
                promises.push(saveToGoogleSheets(orderData));
            }
            
            if (saveToDb) {
                promises.push(saveToDatabase(orderData));
            }
            
            await Promise.all(promises);
        }

        async function saveToGoogleSheets(orderData) {
            // Google Sheets API é›†æˆ
            // æ‚¨éœ€è¦è¨­ç½® Google Apps Script ä¾†æ¥æ”¶æ•¸æ“š
            const scriptUrl = 'https://script.google.com/macros/s/AKfycbxnDlXeKp4Mb6YHLWe8z2B8iuu5nESM0RRI7qGxFQlKyplU1nydG3f3h7B4Ugxbz99D/exec'; // æ›¿æ›ç‚ºæ‚¨çš„ Google Apps Script URL
            
            try {
                const response = await fetch(scriptUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                
                if (!response.ok) {
                    throw new Error('Google Sheets ä¿å­˜å¤±æ•—');
                }
                
                console.log('å·²ä¿å­˜åˆ° Google Sheets');
            } catch (error) {
                console.error('Google Sheets ä¿å­˜éŒ¯èª¤:', error);
                // ä¸æ‹‹å‡ºéŒ¯èª¤ï¼Œå…è¨±å…¶ä»–ä¿å­˜æ–¹å¼ç¹¼çºŒ
            }
        }

        async function saveToDatabase(orderData) {
            // è³‡æ–™åº« API é›†æˆ
            const apiUrl = 'YOUR_DATABASE_API_URL'; // æ›¿æ›ç‚ºæ‚¨çš„è³‡æ–™åº« API URL
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                
                if (!response.ok) {
                    throw new Error('è³‡æ–™åº«ä¿å­˜å¤±æ•—');
                }
                
                console.log('å·²ä¿å­˜åˆ°è³‡æ–™åº«');
            } catch (error) {
                console.error('è³‡æ–™åº«ä¿å­˜éŒ¯èª¤:', error);
                // ä¸æ‹‹å‡ºéŒ¯èª¤ï¼Œå…è¨±å…¶ä»–ä¿å­˜æ–¹å¼ç¹¼çºŒ
            }
        }

        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('show');
        }

        function updateTableNumber() {
            const tableNumber = document.getElementById('tableInput').value;
            document.getElementById('tableNumber').textContent = `${translations[currentLanguage].table_number || 'æ¡Œè™Ÿ'}: ${tableNumber}`;
        }

        function updateBgColor() {
            const color = document.getElementById('bgColorInput').value;
            document.documentElement.style.setProperty('--background-color', color);
        }

        function updateCardColor() {
            const color = document.getElementById('cardColorInput').value;
            document.documentElement.style.setProperty('--card-background', color);
        }

        function updatePrimaryColor() {
            const color = document.getElementById('primaryColorInput').value;
            document.documentElement.style.setProperty('--primary-color', color);
        }

        // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                closeModal(e.target.id);
            }
        });

        // æ·»åŠ å‹•ç•«æ¨£å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); }
                to { transform: translateX(0); }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); }
                to { transform: translateX(100%); }
            }
        `;
        document.head.appendChild(style);

        // PWA æ”¯æŒï¼ˆå¯é¸ï¼‰
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        // è‡ªå‹•è­˜åˆ¥æ¡Œè™Ÿ
        function getTableNumberFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const tableParam = urlParams.get('table');
            if (tableParam) {
                document.getElementById('tableInput').value = tableParam;
                updateTableNumber();
            }
        }
        
        // åœ¨é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            getTableNumberFromURL();
            initializeApp();
        });
    </script>
</body>
</html>
